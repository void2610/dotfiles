# PR レビューコメント修正コマンド

## 目的
あなたはPull Requestのレビューコメントを網羅的に確認しコードを修正するAIアシスタントです。
現在のブランチ紐づいているPR情報を取得し詳細な計画を作り、コードを修正し、修正内容を報告してください。

## 重要な注意事項
- 必要に応じてWEBの情報を参照してください。なお参照する場合は2026年1月時点最新の情報を参照しましょう
- 現在のブランチにPRが紐づいてない場合はここで作業を終了してください

---
## Pull Request 修正手順

### Phase 1: コメント情報の収集
1. `gh pr view --comments` でPRの詳細とコメントを取得
2. `gh api repos/{ORGANIZATION}/{CURRENT_REPO}/pulls/{PR_NUMBER}/comments` で詳細なコメントデータを取得
3. `gh api repos/{ORGANIZATION}/{CURRENT_REPO}/pulls/{PR_NUMBER}/reviews` でレビューコメントを取得
4. 必要に応じて `gh api repos/{ORGANIZATION}/{CURRENT_REPO}/issues/{PR_NUMBER}/comments` で一般コメントも確認

### Phase 2: コメント分析と分類
収集したコメントを以下の観点で分析してください：

1. **コメントの分類**
   - 🔴 必須修正項目（blocking issues）
   - 🟡 推奨修正項目（suggestions）
   - 🟢 質問・議論項目（questions/discussions）

2. **技術的重要度**
   - 🚨 クリティカル（システム障害リスク）
   - 🔥 高（本番環境への影響大）
   - 📈 中（品質・保守性への影響）
   - 📝 低（スタイル・可読性）
   - 🎯 改善提案（将来的な拡張性）

3. **カテゴリー**
   - **仕様適合性に関する指摘**
      - 要件定義との整合性
      - 既存機能の仕様
      - 受け入れ条件
   - **コーディングルールに関する指摘**
      - `docs/cording/example.md``との整合性
      - 命名規則の統一性
      - インデント・フォーマット
   - **パフォーマンスに関する指摘**
      - メモリ使用量の最適化
      - データベースクエリの効率性
      - API呼び出しの最適化
      - キャッシュ戦略
   - **アーキテクチャに関する指摘**
      - 類似実装との統一性
      - 過去意思決定(ADR)との整合性
      - 依存関係の方向性
      - デザインパターンの適用
   - **テスト品質に関する指摘**
      - テストカバレッジの妥当性
      - テストケースの網羅性
      - モックの適切性
      - テストの可読性・保守性
   - **エラーハンドリングに関する指摘**
      - 例外処理の適切性
      - エラーメッセージの明確性
      - ログ出力の妥当性
      - 復旧可能性の考慮
   - **可読性・保守性に関する指摘**
      - コードの自己文書化
      - コメントの適切性
      - 関数・クラスの責務分離
      - 複雑度の管理

4. **影響範囲**
   - 単一ファイル修正
   - 複数ファイル修正
   - アーキテクチャ変更
   - 依存関係変更
   - データベーススキーマ変更
   - API仕様変更

### Phase 3: 修正計画の立案

**重要**
- 分析結果について深く考え(ULTRATHINK)、修正計画を作成してください
- 分類されたコメントのうち修正するのは`必須修正項目`と`推奨修正項目`の2つのみでお願いします。

```markdown
# PR #{PR_NUMBER} 修正計画

## 📋 コメント一覧
| コメントの分類 | カテゴリー | ファイル | 内容 | レビュアー |
|--------|------------|----------|------|-----------|
| 🔴 | Code Quality | src/main.js:15 | 変数名をより具体的に | @reviewer1 |
| 🟡 | Performance | src/api.js:42 | キャッシュ機能の追加検討 | @reviewer2 |

## 🎯 修正方針
### 必須修正項目（Phase 1）
- [ ] 項目1: 詳細な修正内容
- [ ] 項目2: 詳細な修正内容

### 推奨修正項目（Phase 2）
- [ ] 項目1: 詳細な修正内容
- [ ] 項目2: 詳細な修正内容

## 📅 実装順序
1. 必須修正項目の実装
2. 推奨修正項目の実装
3. テスト実行・検証
4. プッシュ・レビュー依頼

## ⚠️ 注意事項
- 質問・議論項目に分類されたものは計画不要です
- 修正により既存機能に影響がないか確認
- テストが全て通ることを確認
- 依存関係の変更がある場合は慎重に検討
`​``

### Phase 4: 計画品質のチェック
- [ ] PR上の全コメントを参照している
- [ ] 全コメントが「必須修正項目」「推奨修正項目」「質問・議論項目」の3つに分類されている
- [ ] コメントの内容が分析されている
- [ ] 具体的で明確な修正方針が作成されている

計画の80%がチェックされている状態になるまで次のフェーズに進まないでください。

### Phase 5: ユーザー確認
`修正計画`を提示し、以下を確認してください：
- 修正方針に問題がないか
- 優先順位が適切か
- 追加で考慮すべき点がないか

**この段階で必ずユーザーの承認を得てから次のPhaseに進んでください。**

### Phase 6: 実装実行
ユーザーの承認後、以下の手順で実装を行ってください：

#### 1. 事前準備
- 現在のブランチの状態確認
- 依存関係の確認
- 計画の確認

#### 2. 修正実装
- 優先度順に修正を実施
- 各修正後にコミットを作成
- コミットメッセージにはPR番号と修正内容を記載

#### 3. 最終確認
  - 全ての必須項目が完了していることを確認
